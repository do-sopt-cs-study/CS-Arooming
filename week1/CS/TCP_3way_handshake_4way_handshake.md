# π“‘ **TCP 3-way handshakeμ™€ 4-way handshake: μ—°κ²° μ„¤μ •κ³Ό ν•΄μ  κ³Όμ •**

## πΒ **TCPλ€? (Transmission Control Protocol)**

μΈν„°λ„· μƒμ—μ„ λ°μ΄ν„°λ¥Ό λ©”μ‹μ§€ ν•νƒλ΅ λ³΄λ‚΄κΈ° μ„ν•΄ **IPμ™€ ν•¨κ» μ‚¬μ©ν•λ” ν”„λ΅ν† μ½**μ„ λ§ν•λ‹¤.

μ¦‰, ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ—°κ²°λ μƒνƒμ—μ„ λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›λ” `μ—°κ²° μ§€ν–¥μ  ν”„λ΅ν† μ½`μ΄λΌκ³  ν•  μ μλ‹¤.

μΌλ°μ μΌλ΅ TCPλ” IPμ™€ ν•¨κ» μ‚¬μ©λλ©° **IP**λ” `λ°°λ‹¬`μ„, **TCP**λ” `ν¨ν‚·μ μ¶”μ  λ° κ΄€λ¦¬`λ¥Ό ν•κ² λλ‹¤.

TCPλ” μ—°κ²°ν• μ„λΉ„μ¤λ΅, `μ‹ λΆ°μ μΈ μ „μ†΅μ„ λ³΄μ¥`ν•κΈ° λ•λ¬Έμ— λ°μ΄ν„°μ νλ¦„μ μ–΄μ™€ νΌμ΅μ μ–΄λ¥Ό μν–‰ν•λ‹¤.

<br />

### π‘£Β TCP νΉμ§•

- `3-way handshake` κ³Όμ •μ„ ν†µν•΄ μ—°κ²°μ„ `μλ¦½`ν•κ³ , `4-way handshake`μ„ ν†µν•΄ μ—°κ²°μ„ `ν•΄μ `ν•λ‹¤.
- μ—°κ²° μ§€ν–¥μ  β†’ μƒλ€λ°©μ΄ λ‚΄ μ‹ νΈλ¥Ό λ°›μ„ μ μλ”μ§€ ν™•μΈν•κ³  μ „μ†΅
- λ†’μ€ μ‹ λΆ°μ„± λ³΄μ¥
- νλ¦„ μ μ–΄ λ° νΌμ΅ μ μ–΄ μν–‰

<br />

### π‘£Β TCP μ‘λ™ λ°©μ‹ (ν° ν‹€)

- λ°μ΄ν„° μ „μ†΅ μ „, 3-way handshake β†’ λ…Όλ¦¬μ  μ ‘μ† μ„±λ¦½
    - λ¨λ“  λ°μ΄ν„°λ” κ³ μ •λ ν†µμ‹  μ„ λ΅λ¥Ό ν†µν•΄ μ „λ‹¬ λ¨
- λ°μ΄ν„° μ „μ†΅μ΄ λλ‚λ©΄ 4-way handshake β†’ λ°μ΄ν„°κ°€ λ¨λ‘ μ „λ‹¬λλ”μ§€ ν™•μΈ β†’ μ—°κ²° ν•΄μ 

λ”°λΌμ„, TCPλ” μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ λ°μ΄ν„°λ¥Ό μ‹ λΆ°μ„± μκ² μ „λ‹¬ν•κΈ° μ„ν•΄ λ§λ“¤μ–΄μ§„ ν”„λ΅ν† μ½μ΄λ‹¤.

λ°μ΄ν„°λ¥Ό μ •ν™•ν•κ³  μ•μ •μ μΌλ΅ μ „λ‹¬ν•  μ μκΈ° λ•λ¬Έμ— λ†’μ€ μ‹ λΆ°μ„±μ„ λ³΄μ¥ν•λ‹¤.

<br />

---

## πΒ **TCP 3-way handshake λ€?**

- μ „μ†΅μ μ–΄ ν”„λ΅ν† μ½(TCP)μ—μ„ ν†µμ‹ ν•λ” μ¥μΉ κ°„ μ—°κ²°μ΄ μ λμ—λ”μ§€ ν™•μΈν•λ” κ³Όμ •/ λ°©μ‹.
- TCP/IP 4κ³„μΈµμ„ ν†µκ³Ό, λ°μ΄ν„°λ¥Ό λ³΄λ‚Ό μ¤€λΉ„κ°€ λλ©΄ μμ‹  μΈ΅μ΄ λ°›μ„ μ¤€λΉ„κ°€ λμ—λ”μ§€ ν™•μΈν•λ” κ³Όμ •.
- 3-way handshakeλ¥Ό μν–‰ν•κΈ° μ„ν•΄μ„λ” TCP ν—¤λ”μ— ν‘μ‹ν• `SYN`κ³Ό `ACK` ν”λκ·Έλ“¤μ΄ μ‚¬μ©λ¨.

<br />

### π‘£Β 3-way handshake κ³Όμ •

![3way handshake](/CS/media/3way%20handshake.png)

1. ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„μ— μ ‘μ† μ”μ²­ λ©”μ‹μ§€ SYN(x) ν¨ν‚· μ „μ†΅.
    - `SYN`(Synchronize Sequence Number): μ„μμ λλ¤ μ«μ
2. μ„λ²„ β†’ SYN(x) λ°›μ β†’ ν΄λΌμ΄μ–ΈνΈμ—κ² μ—°κ²°μ”μ²­ λ©”μ‹μ§€ ACK(x+1) + SYN(y) ν¨ν‚· μ „μ†΅.
    - `ACK`(Acknowledgement number: SYN+1μ κ°’
3. ν΄λΌμ΄μ–ΈνΈ β†’ ACK(x+1) + SYN(y) λ°›μ β†’ μ„λ²„μ— ACK(y+1) μ „μ†΅.

β‡’ 3οΈβƒ£λ²μ ν†µμ‹  μ™„λ£ ν›„, `μ—°κ²° μ„±λ¦½(Established)`

<br />

---

## πΒ **TCP 4-way handshake λ€?**

- μ—°κ²° μ„±λ¦½ ν›„, λ¨λ“  ν†µμ‹ μ΄ λλ‚¬λ‹¤λ©΄ μ΄λ¥Ό ν•΄μ ν•΄μ•Ό ν•¨.
- μ „μ†΅μ μ–΄ ν”„λ΅ν† μ½(TCP)μ—μ„ `ν†µμ‹ μ„ μ¤‘λ‹¨`ν•  λ• μ‚¬μ©ν•λ” κ³Όμ •/ λ°©μ‹
    - μ—°κ²° μ¤‘λ‹¨ μ‹, ν• λ² λ” ν™•μΈ ν›„ ν•΄μ 
- λ°μ΄ν„° μ†΅μμ‹ μ΄ μ™„λ£λλ©΄ `TCP μ—°κ²°μ„ ν•΄μ `ν•λ” κ³Όμ •
- 4-way handshakeλ¥Ό μν–‰ν•κΈ° μ„ν•΄μ„λ” TCP ν—¤λ”μ— ν‘μ‹ν• `ACK`μ™€ `FIN` ν”λκ·Έλ“¤μ΄ μ‚¬μ©λ¨.

<br />

### π‘£Β TCP 4-way handshake κ³Όμ •

![4way handshake](/CS/media/4way%20handshake.png)

1. ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„μ—κ² μ—°κ²° μΆ…λ£λ¥Ό μ•λ¦¬λ” FIN ν”λκ·Έκ°€ μ„¤μ •λ ν¨ν‚· μ „μ†΅.
    - `FIN` (finish): μ„Έμ…μ„ μΆ…λ£μ‹ν‚¤λ”λ° μ‚¬μ©λ¨, λ”μ΄μƒ λ³΄λ‚Έ λ°μ΄ν„°κ°€ μ—†μμ„ μλ―Έ
2. μ„λ²„ β†’ FIN μ‹ νΈ ν™•μΈ β†’ ν™•μΈν–λ‹¤κ³  μ•λ ¤μ£ΌκΈ° μ„ν•΄ ACK μ‹ νΈ μ „μ†΅.
    - μ΄λ•, λ¨λ“  λ°μ΄ν„°λ¥Ό λ³΄λ‚΄κΈ° μ„ν•΄ CLOSE_WAIT μƒνƒ λμ….
3. μ„λ²„ ν†µμ‹  λ β†’ μ—°κ²° μΆ…λ£ μ”μ²­ ν•©μμ μλ―Έλ΅ ν΄λΌμ΄μ–ΈνΈμ—κ² FIN ν”λκ·Έκ°€ μ„¤μ •λ ν¨ν‚· μ „μ†΅.
4. ν΄λΌμ΄μ–ΈνΈ β†’ FIN λ°›μ β†’ ν™•μΈμ μλ―Έλ΅ ACK ν”λκ·Έκ°€ μ„¤μ •λ ν¨ν‚· λ³΄λƒ„
    - μ•„μ§ μ„λ²„λ΅λ¶€ν„° λ°›μ§€ λ»ν• λ°μ΄ν„°κ°€ μμ„ μ μμΌλ―€λ΅ TIME_WAITμ„ ν†µν•΄ κΈ°λ‹¤λ¦Ό
    - TIME_WAIT: μλ„μΉ μ•μ€ μ—λ¬λ΅ μΈν•΄ μ—°κ²°μ΄ λ°λ“λ½μΌλ΅ λΉ μ§€λ” κ²ƒ λ°©μ§€ λ©μ 
        - μ—λ¬ λ°μƒ β†’ μΆ…λ£ μ§€μ—° β†’ νƒ€μ„ μ΄κ³Ό β†’ CLOSED μƒνƒλ΅ λ³€κ²½
    - μ„λ²„ β†’ ACK λ°›μ€ μ΄ν›„ μ†μΌ“ λ‹«μ (Closed)
    - ν΄λΌμ΄μ–ΈνΈ β†’ TIME_WAIT μ‹κ°„μ΄ λλ‚λ©΄ ν΄λΌμ΄μ–ΈνΈ λ‹«μ(Closed)

β‡’ 4οΈβƒ£λ²μ ν†µμ‹  μ΄ν›„, `μ—°κ²° ν•΄μ `